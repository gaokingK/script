import datetime
import re

June = {"01": "08:52:16-18:17:16", "02": "08:48:08-18:27:32", "06": "08:28:15-20:24:10",
        "07": "08:26:43-18:10:51", "08": "08:26:39-18:44:55", "09": "08:55:36-18:10:21",
        "10": "08:34:25-18:11:10", "13": "08:28:41-20:34:25", "14": "08:29:15-20:34:12",
        "15": "08:25:18-19:51:01", "16": "08:40:36-20:47:57", "17": "08:49:11-20:33:04",
        "20": "08:40:49-20:42:07", "21": "09:06:46-20:53:33", "22": "09:12:47-18:20:56",
        "23": "09:08:36-20:40:32", "24": "09:18:45-18:39:24", "27": "09:15:43-18:01:39",
        }  # 加班一天 已发
July = {'01': '09:13:15-18:04:44', '04': '09:09:38-18:02:31', '05': '09:25:43-20:47:23', '06': '08:56:49-18:03:22',
        '07': '09:20:40-20:31:21', '08': '09:05:03-18:03:12', '11': '09:10:46-18:04:30', '12': '09:16:27-20:33:15',
        '13': '09:12:07-18:34:54', '14': '09:12:04-20:40:47', '15': '09:20:45-18:24:31', '18': '09:09:59-20:54:26',
        '19': '09:01:38-20:37:23', '20': '09:13:53-20:31:15', '21': '08:59:04-20:33:36', '22': '09:05:34-18:04:56',
        '25': '09:19:40-19:47:22', '26': '09:19:06-21:06:18', '27': '08:53:21-20:35:05', '28': '09:15:26-20:32:28',
        '29': '09:24:49-20:52:05'}  # 加班一天 已发

Aug = {'01': '09:20:53-20:34:41', '02': '09:13:26-20:31:20', '03': '09:18:48-19:48:36', '04': '09:07:45-20:44:31',
       '05': '09:17:25-18:01:53', '08': '09:15:31-18:08:06', '09': '09:14:44-21:10:44', '10': '09:08:59-20:31:23'
       }  # 加班两天 共 14 小时 已发


Sep = {'01': '09:05:17-20:35:12', '02': '09:11:47-20:29:18', '05': '09:25:00-19:33:47', '06': '09:02:49-19:49:05',
       '07': '09:16:08-18:01:19', '08': '09:21:18-19:01:40', '09': '09:15:31-18:57:43', '13': '09:15:34-21:02:32',
       '14': '09:17:33-18:01:22', '15': '08:38:23-21:17:07', '16': '10:58:55-18:01:48', '19': '09:18:26-20:36:59',
       '20': '09:25:31-18:27:55', '21': '09:19:11-20:30:56', '22': '09:16:30-20:47:37', '23': '09:19:03-18:01:15',
       '26': '09:19:59-20:37:49', '27': '09:21:11-20:36:13', '28': '09:20:57-18:01:57', '29': '09:01:06-20:31:05',
       }  # 加班四天 请假2.5个小时

Oct = {'15': '09:07:38-20:35:04', '16': '09:04:24-20:47:48', '17': '09:16:36-20:23:37', '18': '08:49:35-18:41:18',
       '21': '09:14:53-20:31:52', '22': '09:13:02-20:02:12', '23': '09:15:07-18:01:19', '24': '09:13:55-18:22:01',
       '30': '09:13:55-21:37:01'}  # 加班一天，请假1.5个小时

Nov = {}  # 加班2天
Dec = {'01': '09:11:38-20:34:49', '02': '09:18:34-18:14:48', '05': '09:16:57-20:56:44', '06': '09:22:23-20:25:52',
       '07': '09:22:47-18:01:20', '08': '09:20:46-20:39:08', '09': '09:22:53-18:06:29', '12': '09:08:47-20:38:13',
       '13': '09:22:44-20:13:50', '14': '09:24:02-18:05:19', '15': '09:09:39-21:04:39', '16': '09:19:05-18:03:02',
       '19': '09:21:23-22:58:35', '20': '09:19:58-18:03:13', '21': '09:23:48-22:53:02', '22': '08:54:16-20:55:12'}
Jan = {'03': '09:21:51-18:01:14', '04': '09:22:43-20:44:13', '05': '09:24:55-20:36:27', '06': '09:23:34-18:01:46',
        '07': '08:27:23-20:13:28', '09': '09:26:02-20:57:03', '10': '09:25:08-20:21:48', '11': '09:25:48-18:06:14',
        '12': '09:24:56-20:26:53', '13': '09:20:14-18:38:52', '16': '09:23:11-20:49:35', '17': '09:24:59-19:25:27',
        '18': '09:24:55-18:01:15', '19': '09:18:20-18:01:43', '20': '09:26:23-18:04:01', '28': '09:25:10-18:01:54',
        '29': '09:08:01-18:12:04', '30': '09:05:17-23:50:36', '31': '08:22:01-23:40:04'}  # 8.610526315789473
Feb = {'01': '09:23:16-19:06:53', '02': '09:15:34-19:29:11', '03': '09:01:50-18:07:59', '06': '08:59:15-19:26:09',
       '07': '09:07:56-21:08:25', '08': '09:01:22-21:26:03', '09': '09:08:52-20:07:22', '10': '09:12:33-18:07:08',
       '13': '08:53:46-20:31:36', '14': '09:01:23-20:20:08', '15': '09:06:00-19:32:11', '16': '09:11:01-20:55:23',
       '17': '09:06:52-18:15:03', '20': '08:57:41-20:49:37', '21': '08:55:20-20:34:37', '22': '09:02:45-20:43:38',
       '23': '09:04:15-21:03:34', '24': '09:01:53-21:21:28', '27': '09:17:42-21:09:10'}  # 9.07

time_str = """2023-04-01
2023-04-02
2023-04-03
正常
09:28:42
20:47:46
2023-04-04
正常
09:24:44
18:02:11
2023-04-05
2023-04-06
正常
09:25:47
21:13:56
2023-04-07
正常
09:01:34
22:37:05
2023-04-08
2023-04-09
2023-04-10
正常
09:20:09
19:33:14"""


def stmap2num(timestamp):
    "感觉还不如用datetime呢"
    return float(timestamp[3:5]) / 60 + int(timestamp[0:2])


def valid_time(day_str):
    l_time, r_time = map(lambda x: x[:-2] + "00", day_str.split("-"))
    l_time, r_time = map(lambda x: re.match(r"([0-1][0-9]|2[0-3]).{6}", x).group(), [l_time, r_time])
    # start_time
    if l_time[:5] > "09:30":
        l_time = "08:30:00"
    if re.match(r"(08:([0-2][0-9]|30))", l_time):
        l_time = "08:30:00"
    # end_time
    if re.match(r"(18:([0-2][0-9]|30))", r_time):
        r_time = "18:00:00"
    elif re.match(r"(18:([3-5][0-9]))|19|2[0-3]", r_time):
        r_time = (datetime.datetime.strptime(r_time, "%H:%M:%S") + datetime.timedelta(hours=-0.5)).strftime("%H:%M:%S")
    return list(map(stmap2num, [l_time, r_time]))


def span_day(time_str):
    start, end = valid_time(time_str)
    span_time = end - start - 1.5
    return span_time


def str2dict(fuck_str):
    fuck_time = re.findall(r"(2023-\d\d-\d\d)(?:\n\w+\n)(\d\d:\d\d:\d\d).?(\d\d:\d\d:\d\d)", fuck_str, re.DOTALL)
    fuck_res = {}
    for item in fuck_time:
        fuck_res[item[0].split("-")[-1]] = f"{item[1]}-{item[2]}"
    print(fuck_res)
    return fuck_res


def calc_average(data):
    if isinstance(data, str):
        data = str2dict(data)
    total_time = 0
    for key, value in data.items():
        total_time += span_day(value)
    print(f"average: {total_time/len(data)}")


if __name__ == '__main__':
    calc_average(time_str)
